pkgname=8192cu-dkms
pkgver=3.4.3_4369.20120622
pkgrel=1
pkgdesc='Drivers for realtek RTL8188CUS (8188C, 8192C) chipset wireless cards'
arch=('i686' 'x86_64')
url='http://218.210.127.131/downloads/downloadsView.aspx?Langid=1&PNid=48&PFid=48&Level=5&Conn=4&DownTypeID=3&GetDown=false&Downloads=true#RTL8192CU'
license=('GPL2')
depends=('dkms' 'linux' 'linux-headers')
provides=('8192cu' 'rt8192cu')
conflicts=('8192cu' 'rt8192cu')
install='8192cu-dkms.install'
source=("ftp://WebUser:AxPL9s3k@95.130.192.218/cn/wlan/RTL819xCU%20_USB_linux_v${pkgver}.zip" '9041.patch' 'ksrc.patch' 'dkms.conf')
md5sums=('77d60a647c22b253fe11b817402c5b3b'
         '2d5a19584db7e9ffe8736ea4defdb6f8'
         '28c0510ad18332525a684521a08e3f9f'
         '81ad1af5b857a8f31f720d131b19481c')
options=('!strip')

_pkgname=${pkgname%-dkms}
_pkgver=${pkgver%.*}

package() {
    cd ${srcdir}/RTL8188C_8192C_USB_linux_v${pkgver}/driver
    tar xvfz rtl8188C_8192C_usb_linux_v${pkgver}.tar.gz
    cd rtl8188C_8192C_usb_linux_v${pkgver}
    patch -p1 < ${srcdir}/9041.patch
    patch -p1 < ${srcdir}/ksrc.patch
    cd ..

    mkdir -p ${pkgdir}/usr/src/${_pkgname}-${_pkgver}
    cp ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_pkgname}-${_pkgver}
    cp -a rtl8188C_8192C_usb_linux_v${pkgver}/* ${pkgdir}/usr/src/${_pkgname}-${_pkgver}

    sed -i "s/^ver=.*/ver=${_pkgver}/" ${startdir}/8192cu-dkms.install
    sed -i "s/^PACKAGE_VERSION=.*/PACKAGE_VERSION=${_pkgver}/" ${pkgdir}/usr/src/${_pkgname}-${_pkgver}/dkms.conf

    if [ "${CARCH}" == "arm" ]; then
        sed -i "s/CARCH/${CARCH}/" ${pkgdir}/usr/src/${_pkgname}-${_pkgver}/dkms.conf
    else
        sed -i "s/ARCH=CARCH//" ${pkgdir}/usr/src/${_pkgname}-${_pkgver}/dkms.conf
    fi
}
