pkgname=tp_smapi-dkms
pkgver=0.41
pkgrel=8
pkgdesc="DKMS controlled modules for ThinkPad's SMAPI functionality"
arch=(any)
url="http://www.thinkwiki.org/wiki/Tp_smapi"
license=('GPL')
depends=('dkms')
conflicts=('tp_smapi')
provides=("tp_smapi=${pkgver%.*}")
options=(!strip)
install='tp_smapi-dkms.install'
source=('https://github.com/evgeni/tp_smapi/archive/master.tar.gz' 'kbase.patch' 'dkms.conf')
sha256sums=('2a4145173e67aa4dd8d4b8dc4180a965f18c1e8b47c5ade9d24559e8b9baf32b'
            '70781530f6f76279ac968897bfa4231059d174e21ebd13d1bcb17f07471421d9'
            'e2d3db8b9bd5c53cba1d702e36814ec56ef52dd37dfe8a03f58deb83c11c8bed')

package() 
{
    # patch Makefile for recent kernel module directory change
    patch -p1 < kbase.patch

    mkdir -p "${pkgdir}"/usr/src/${pkgname}-${pkgver}
    cp -a tp_smapi-master/{*.{h,c},Makefile} "${pkgdir}"/usr/src/${pkgname}-${pkgver}
    cp dkms.conf "${pkgdir}"/usr/src/${pkgname}-${pkgver}
}
